#!/usr/bin/python

if False:
  # see: http://pychecker.sourceforge.net/
  import os
  os.environ['PYCHECKER'] = '--stdlib -100'
  import pychecker.checker


import GG.model.ggsystem
import dMVC
import dMVC.remoteserver
from optparse import OptionParser
import sys

__usage__ = "\n  %s -P puerto"%sys.argv[0]
parser = OptionParser( usage = __usage__ )
parser.add_option("-P",dest="port", help="puerto",default=8000, type = int)
(params, args) = parser.parse_args()

if __name__ == "__main__":
  def onLogin(rhandler, result, error):
    if result[0]:
      rhandler.ggSession = result[1]
    else:
      rhandler.ggSession = None
  
  def onDisconnection(rhandler):
    if hasattr(rhandler, 'ggSession'):
      if rhandler.ggSession:
        rhandler.ggSession.logout()
        server = dMVC.getRServer().getSocket()
        server.finish_request(rhandler.request, rhandler.client_address)

  onExecution = [ [GG.model.ggsystem.GGSystem, 'login', onLogin] ]

  print "Iniciado el servidor del juego Gente Guada V. 0.7.1-1"
  dMVC.remoteserver.RServer(GG.model.ggsystem.GGSystem(),port = params.port, onDisconnection = onDisconnection, onExecution = onExecution)
